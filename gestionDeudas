--
-- PostgreSQL database dump
--

\restrict EEGNcpBTOTqWCkcEZEMGLFEOTikgfcH2bIckFC4CjC6EgGKaIQXJknHJtzWU7xd

-- Dumped from database version 17.6
-- Dumped by pg_dump version 17.6

-- Started on 2025-09-08 09:50:11

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET transaction_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- TOC entry 2 (class 3079 OID 16576)
-- Name: uuid-ossp; Type: EXTENSION; Schema: -; Owner: -
--

CREATE EXTENSION IF NOT EXISTS "uuid-ossp" WITH SCHEMA public;


--
-- TOC entry 5005 (class 0 OID 0)
-- Dependencies: 2
-- Name: EXTENSION "uuid-ossp"; Type: COMMENT; Schema: -; Owner: -
--

COMMENT ON EXTENSION "uuid-ossp" IS 'generate universally unique identifiers (UUIDs)';


--
-- TOC entry 237 (class 1255 OID 16715)
-- Name: cleanup_expired_sessions(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.cleanup_expired_sessions() RETURNS void
    LANGUAGE plpgsql
    AS $$
BEGIN
    DELETE FROM user_sessions 
    WHERE expires_at < CURRENT_TIMESTAMP OR is_active = false;
    
    DELETE FROM email_verifications 
    WHERE expires_at < CURRENT_TIMESTAMP OR is_used = true;
END;
$$;


--
-- TOC entry 236 (class 1255 OID 16701)
-- Name: update_updated_at_column(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_updated_at_column() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- TOC entry 221 (class 1259 OID 16638)
-- Name: friendships; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.friendships (
    friendship_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    requester_id uuid NOT NULL,
    addressee_id uuid NOT NULL,
    status character varying(20) DEFAULT 'pending'::character varying,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT different_friends CHECK ((requester_id <> addressee_id)),
    CONSTRAINT friendships_status_check CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'accepted'::character varying, 'blocked'::character varying])::text[])))
);


--
-- TOC entry 218 (class 1259 OID 16587)
-- Name: users; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.users (
    user_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    email character varying(100) NOT NULL,
    password_hash character varying(255) NOT NULL,
    first_name character varying(50) NOT NULL,
    last_name character varying(50) NOT NULL,
    phone character varying(20),
    is_active boolean DEFAULT true,
    email_verified boolean DEFAULT false,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- TOC entry 225 (class 1259 OID 16710)
-- Name: accepted_friends; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.accepted_friends AS
 SELECT f.requester_id AS user_id,
    f.addressee_id AS friend_id,
    u1.email AS user_email,
    u1.first_name AS user_first_name,
    u1.last_name AS user_last_name,
    u2.email AS friend_email,
    u2.first_name AS friend_first_name,
    u2.last_name AS friend_last_name,
    f.created_at AS friends_since
   FROM ((public.friendships f
     JOIN public.users u1 ON ((f.requester_id = u1.user_id)))
     JOIN public.users u2 ON ((f.addressee_id = u2.user_id)))
  WHERE ((f.status)::text = 'accepted'::text)
UNION
 SELECT f.addressee_id AS user_id,
    f.requester_id AS friend_id,
    u1.email AS user_email,
    u1.first_name AS user_first_name,
    u1.last_name AS user_last_name,
    u2.email AS friend_email,
    u2.first_name AS friend_first_name,
    u2.last_name AS friend_last_name,
    f.created_at AS friends_since
   FROM ((public.friendships f
     JOIN public.users u1 ON ((f.addressee_id = u1.user_id)))
     JOIN public.users u2 ON ((f.requester_id = u2.user_id)))
  WHERE ((f.status)::text = 'accepted'::text);


--
-- TOC entry 219 (class 1259 OID 16599)
-- Name: debts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.debts (
    debt_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    creditor_id uuid NOT NULL,
    debtor_id uuid NOT NULL,
    amount numeric(10,2) NOT NULL,
    description text,
    status character varying(20) DEFAULT 'pending'::character varying,
    due_date date,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT debts_amount_check CHECK ((amount > (0)::numeric)),
    CONSTRAINT debts_status_check CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'paid'::character varying, 'cancelled'::character varying])::text[]))),
    CONSTRAINT different_users CHECK ((creditor_id <> debtor_id))
);


--
-- TOC entry 223 (class 1259 OID 16676)
-- Name: email_verifications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.email_verifications (
    verification_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    user_id uuid NOT NULL,
    verification_token character varying(255) NOT NULL,
    expires_at timestamp without time zone NOT NULL,
    is_used boolean DEFAULT false,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- TOC entry 220 (class 1259 OID 16623)
-- Name: payments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payments (
    payment_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    debt_id uuid NOT NULL,
    amount numeric(10,2) NOT NULL,
    payment_method character varying(50),
    notes text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT payments_amount_check CHECK ((amount > (0)::numeric))
);


--
-- TOC entry 224 (class 1259 OID 16705)
-- Name: user_balance; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.user_balance AS
 SELECT u.user_id,
    u.email,
    u.first_name,
    u.last_name,
    COALESCE(credits.total_owed_to_me, (0)::numeric) AS total_owed_to_me,
    COALESCE(debts_owed.total_i_owe, (0)::numeric) AS total_i_owe,
    (COALESCE(credits.total_owed_to_me, (0)::numeric) - COALESCE(debts_owed.total_i_owe, (0)::numeric)) AS net_balance
   FROM ((public.users u
     LEFT JOIN ( SELECT d.creditor_id,
            sum((d.amount - COALESCE(paid.total_paid, (0)::numeric))) AS total_owed_to_me
           FROM (public.debts d
             LEFT JOIN ( SELECT payments.debt_id,
                    sum(payments.amount) AS total_paid
                   FROM public.payments
                  GROUP BY payments.debt_id) paid ON ((d.debt_id = paid.debt_id)))
          WHERE ((d.status)::text = 'pending'::text)
          GROUP BY d.creditor_id) credits ON ((u.user_id = credits.creditor_id)))
     LEFT JOIN ( SELECT d.debtor_id,
            sum((d.amount - COALESCE(paid.total_paid, (0)::numeric))) AS total_i_owe
           FROM (public.debts d
             LEFT JOIN ( SELECT payments.debt_id,
                    sum(payments.amount) AS total_paid
                   FROM public.payments
                  GROUP BY payments.debt_id) paid ON ((d.debt_id = paid.debt_id)))
          WHERE ((d.status)::text = 'pending'::text)
          GROUP BY d.debtor_id) debts_owed ON ((u.user_id = debts_owed.debtor_id)))
  WHERE (u.is_active = true);


--
-- TOC entry 222 (class 1259 OID 16661)
-- Name: user_sessions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_sessions (
    session_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    user_id uuid NOT NULL,
    refresh_token character varying(500) NOT NULL,
    expires_at timestamp with time zone NOT NULL,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    is_active boolean DEFAULT true
);


--
-- TOC entry 4995 (class 0 OID 16599)
-- Dependencies: 219
-- Data for Name: debts; Type: TABLE DATA; Schema: public; Owner: -
--

COPY public.debts (debt_id, creditor_id, debtor_id, amount, description, status, due_date, created_at, updated_at) FROM stdin;
660f9500-f39c-52e5-b827-557766551001	550e8400-e29b-41d4-a716-446655440001	550e8400-e29b-41d4-a716-446655440002	150000.00	Almuerzo y gasolina viaje Bogotá	pending	2024-10-15	2025-09-04 22:44:40.164312	2025-09-04 22:44:40.164312
660f9500-f39c-52e5-b827-557766551002	550e8400-e29b-41d4-a716-446655440002	550e8400-e29b-41d4-a716-446655440003	85000.00	Compras supermercado reunión	pending	2024-09-30	2025-09-04 22:44:40.164312	2025-09-04 22:44:40.164312
660f9500-f39c-52e5-b827-557766551003	550e8400-e29b-41d4-a716-446655440003	550e8400-e29b-41d4-a716-446655440001	220000.00	Reparación carro mecánico	pending	2024-10-20	2025-09-04 22:44:40.164312	2025-09-04 22:44:40.164312
7f91ce6d-a11f-48ba-a550-ce42e598ba33	49b6f2f0-cc9d-47c9-ad57-cd212c28d71a	550e8400-e29b-41d4-a716-446655440001	20.00	Deuda	pending	2025-09-10	2025-09-05 17:12:46.898685	2025-09-05 17:12:46.898723
cafb7fb8-e11f-423f-8937-a65d4e48ef41	49b6f2f0-cc9d-47c9-ad57-cd212c28d71a	550e8400-e29b-41d4-a716-446655440004	50.00	Deuda urgente	paid	2025-09-08	2025-09-05 17:31:20.456841	2025-09-05 17:31:38.186962
008416ce-1584-4cce-9ff1-724ed1357616	bb74ab4b-21b2-4953-b481-23b7bf4f729b	550e8400-e29b-41d4-a716-446655440005	3000.00	Deuda principal	pending	2025-09-10	2025-09-05 23:48:33.713553	2025-09-05 23:53:26.466042
e312b578-22ca-4002-858d-6bae34f404e6	bb74ab4b-21b2-4953-b481-23b7bf4f729b	550e8400-e29b-41d4-a716-446655440001	800.00	Favor	paid	2025-09-08	2025-09-05 23:53:49.148253	2025-09-05 23:53:56.564629
fed68bcb-cf04-48b8-9c46-abd934e757ed	bb74ab4b-21b2-4953-b481-23b7bf4f729b	550e8400-e29b-41d4-a716-446655440003	500.00	Para el bus	paid	2025-09-08	2025-09-06 00:01:14.729483	2025-09-06 00:01:24.586102
\.


--
-- TOC entry 4999 (class 0 OID 16676)
-- Dependencies: 223
-- Data for Name: email_verifications; Type: TABLE DATA; Schema: public; Owner: -
--

COPY public.email_verifications (verification_id, user_id, verification_token, expires_at, is_used, created_at) FROM stdin;
0d730572-4c7a-4d6b-baa8-9168d434c108	49b6f2f0-cc9d-47c9-ad57-cd212c28d71a	4TfP63JpW0VUF78z89OZ9-TxWrhzAFfjguONBwz0Lms=	2025-09-06 01:50:17.151902	f	2025-09-05 01:50:17.152124
\.


--
-- TOC entry 4997 (class 0 OID 16638)
-- Dependencies: 221
-- Data for Name: friendships; Type: TABLE DATA; Schema: public; Owner: -
--

COPY public.friendships (friendship_id, requester_id, addressee_id, status, created_at, updated_at) FROM stdin;
72c56634-aba8-4256-bb47-20de5a3d1177	550e8400-e29b-41d4-a716-446655440001	550e8400-e29b-41d4-a716-446655440002	accepted	2025-09-04 22:44:40.164312	2025-09-04 22:44:40.164312
243e9352-eb21-47b2-b0df-d67a3042e558	550e8400-e29b-41d4-a716-446655440001	550e8400-e29b-41d4-a716-446655440003	accepted	2025-09-04 22:44:40.164312	2025-09-04 22:44:40.164312
0e480a0f-b4ac-4e07-bf00-7438f8a6e110	550e8400-e29b-41d4-a716-446655440002	550e8400-e29b-41d4-a716-446655440003	accepted	2025-09-04 22:44:40.164312	2025-09-04 22:44:40.164312
26709a3e-94ce-46dc-ad08-094e270de1ca	550e8400-e29b-41d4-a716-446655440004	550e8400-e29b-41d4-a716-446655440001	pending	2025-09-04 22:44:40.164312	2025-09-04 22:44:40.164312
8a99d9b0-42b2-4726-a4ad-9dc4ca6316e4	550e8400-e29b-41d4-a716-446655440005	550e8400-e29b-41d4-a716-446655440002	accepted	2025-09-04 22:44:40.164312	2025-09-04 22:44:40.164312
\.


--
-- TOC entry 4996 (class 0 OID 16623)
-- Dependencies: 220
-- Data for Name: payments; Type: TABLE DATA; Schema: public; Owner: -
--

COPY public.payments (payment_id, debt_id, amount, payment_method, notes, created_at) FROM stdin;
770fa600-fa4d-63f6-c938-668877662001	660f9500-f39c-52e5-b827-557766551001	50000.00	Nequi	Primer abono del viaje	2025-09-04 22:44:40.164312
770fa600-fa4d-63f6-c938-668877662002	660f9500-f39c-52e5-b827-557766551002	85000.00	Efectivo	Pago completo supermercado	2025-09-04 22:44:40.164312
\.


--
-- TOC entry 4998 (class 0 OID 16661)
-- Dependencies: 222
-- Data for Name: user_sessions; Type: TABLE DATA; Schema: public; Owner: -
--

COPY public.user_sessions (session_id, user_id, refresh_token, expires_at, created_at, is_active) FROM stdin;
5fb379de-f4de-4653-9a93-6c22c8f7d93b	49b6f2f0-cc9d-47c9-ad57-cd212c28d71a	dpRMIwHmE4EhdoLhu5R7iNSJcXScXJuEKZs12NP48hw=	2025-09-12 13:05:26.118649-05	2025-09-05 13:05:51.896256-05	t
4ea422c0-f525-4d60-90a3-fa4447db5166	49b6f2f0-cc9d-47c9-ad57-cd212c28d71a	XKuLA0m9IkYRT4vqPlH0I8F1KKeZECjLIg5L1ke8Cqg=	2025-09-12 22:01:48.058445-05	2025-09-05 22:01:48.058955-05	t
b2d72338-dd0c-4374-95b5-f608baf90ba2	49b6f2f0-cc9d-47c9-ad57-cd212c28d71a	+2v04x4GRX4Fxjvq21NyTMafnr2gt2hrXV7LUSmO95Y=	2025-09-12 22:30:29.278259-05	2025-09-05 22:30:29.27893-05	t
1452d08b-34c7-4726-8890-4ef503a5b537	bb74ab4b-21b2-4953-b481-23b7bf4f729b	f+TNo+x48bVK9Mf3GVauGD1WNNxiTfTl88J9srdo+Pc=	2025-09-13 00:57:34.895868-05	2025-09-06 00:57:34.896138-05	t
9c472a7b-9861-4004-946c-4d9304898799	49b6f2f0-cc9d-47c9-ad57-cd212c28d71a	iR6lFNj4ymu1kKN8JrmpyTxCbB11xAz7qu3j523q4Qk=	2025-09-13 01:05:50.44114-05	2025-09-06 01:05:50.441149-05	t
fd10a95e-fccc-4563-8984-8cb3e5c7a99e	49b6f2f0-cc9d-47c9-ad57-cd212c28d71a	O6NnYELvhayRZa8+7pP3QV6eNS6Cmbv49gMvwp55wZw=	2025-09-13 01:07:16.746918-05	2025-09-06 01:07:16.74694-05	t
252a8bc7-5599-4ea5-a29f-712f3d621420	49b6f2f0-cc9d-47c9-ad57-cd212c28d71a	1V9i+zCr8Yl4UnFGJzrAt7yy2mDBk7kA5dVZkYpDp38=	2025-09-13 01:22:50.587154-05	2025-09-06 01:22:50.587428-05	t
81b816b8-e799-48d6-8086-88dfe9c9360e	49b6f2f0-cc9d-47c9-ad57-cd212c28d71a	mqgoTQJwL65HHwiIPzxz+Lmo9avgYC9GKgoEifBjHVQ=	2025-09-13 01:53:39.083658-05	2025-09-06 01:53:39.083674-05	t
5d5c7c48-80c5-418b-bbf2-74f123f0c005	49b6f2f0-cc9d-47c9-ad57-cd212c28d71a	aQ8CVhEWdpXJDC/9rryVkdbQmdcCxAgGcRNKGymPH7w=	2025-09-13 02:14:37.84304-05	2025-09-06 02:14:37.843052-05	t
531352ab-2863-461b-88b8-50c57d526af2	49b6f2f0-cc9d-47c9-ad57-cd212c28d71a	tasS6BCcChQhyLe2Batn+tFkT9XU/8rw+t8b+mxSGNI=	2025-09-13 02:30:26.202387-05	2025-09-06 02:30:26.203158-05	t
42bee132-4bb0-4ccf-a0e9-3c1f31e9bb11	49b6f2f0-cc9d-47c9-ad57-cd212c28d71a	sZhimn2TbJxkXIWi4AMLLcCE2cdheARJzMx1faxXNqg=	2025-09-13 02:47:50.693157-05	2025-09-06 02:47:50.694354-05	t
4d58fc5a-251d-40bc-a56e-00aae0b5cfc3	49b6f2f0-cc9d-47c9-ad57-cd212c28d71a	P+ikNAasfNeoDv6fXKBraWRLuCpPRAr0wzB7REAWST4=	2025-09-13 02:55:20.372191-05	2025-09-06 02:55:20.372201-05	t
fd4cfd6c-f1c1-44ef-95e9-549eea23cdcb	bb74ab4b-21b2-4953-b481-23b7bf4f729b	AGFW+M+0WRpeMBrS2QS0lx7eSNeiHIFTyoUD/9ftb1g=	2025-09-13 02:57:19.998191-05	2025-09-06 02:57:19.998199-05	t
4c8737dd-e67b-4f5a-b394-587b2a4513e5	49b6f2f0-cc9d-47c9-ad57-cd212c28d71a	R/iTuuuZ6Mm7mK6y3W9j6iHa/RWDUhFCsAScj7Tjgtw=	2025-09-13 03:22:36.428024-05	2025-09-06 03:22:36.428237-05	t
6f300905-ecfc-4db2-a0ee-ca806fc173ba	bb74ab4b-21b2-4953-b481-23b7bf4f729b	vxKoNnmsG8NlSqcZvGFBUnNJOpPKklJZp1rMHMrB4Ag=	2025-09-13 04:47:56.54167-05	2025-09-06 04:47:56.542297-05	t
0c198639-f365-4fe4-853f-5ecee5e7b896	bb74ab4b-21b2-4953-b481-23b7bf4f729b	iEVWfDMLOezaN0k+PVA6v01e/8pdunoLRhQjfG5UNSQ=	2025-09-13 04:50:08.114009-05	2025-09-06 04:50:08.114044-05	t
\.


--
-- TOC entry 4994 (class 0 OID 16587)
-- Dependencies: 218
-- Data for Name: users; Type: TABLE DATA; Schema: public; Owner: -
--

COPY public.users (user_id, email, password_hash, first_name, last_name, phone, is_active, email_verified, created_at, updated_at) FROM stdin;
550e8400-e29b-41d4-a716-446655440001	ana.rodriguez@email.com	$2a$10$hashejemplo1	Ana	Rodríguez	+57 300 123 4567	t	t	2025-09-04 22:44:40.164312	2025-09-04 22:44:40.164312
550e8400-e29b-41d4-a716-446655440002	carlos.mendez@email.com	$2a$10$hashejemplo2	Carlos	Méndez	+57 301 234 5678	t	t	2025-09-04 22:44:40.164312	2025-09-04 22:44:40.164312
550e8400-e29b-41d4-a716-446655440003	maria.gutierrez@email.com	$2a$10$hashejemplo3	María	Gutiérrez	+57 302 345 6789	t	t	2025-09-04 22:44:40.164312	2025-09-04 22:44:40.164312
550e8400-e29b-41d4-a716-446655440004	david.silva@email.com	$2a$10$hashejemplo4	David	Silva	+57 303 456 7890	t	f	2025-09-04 22:44:40.164312	2025-09-04 22:44:40.164312
550e8400-e29b-41d4-a716-446655440005	lucia.torres@email.com	$2a$10$hashejemplo5	Lucía	Torres	+57 304 567 8901	t	t	2025-09-04 22:44:40.164312	2025-09-04 22:44:40.164312
49b6f2f0-cc9d-47c9-ad57-cd212c28d71a	dlinares16@yahoo.es	$2a$12$ZsjUGkrooSj9orcskQv/Y.lRgJdppjUjqZ5TZKHY2NKrKD8kZxmji	Daniel	Linares	\N	t	f	2025-09-05 01:50:00.42692	2025-09-05 01:50:02.644834
bb74ab4b-21b2-4953-b481-23b7bf4f729b	mrivera@gmail.com	$2a$12$fqKVyrIZsPdSFnJjUrZSe.a0AYLp3uFAPD1aypDSpP/kevja0qjbu	Daniel	Linares 	\N	t	f	2025-09-05 19:57:30.477167	2025-09-05 19:57:30.477693
\.


--
-- TOC entry 4816 (class 2606 OID 16612)
-- Name: debts debts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.debts
    ADD CONSTRAINT debts_pkey PRIMARY KEY (debt_id);


--
-- TOC entry 4835 (class 2606 OID 16683)
-- Name: email_verifications email_verifications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_verifications
    ADD CONSTRAINT email_verifications_pkey PRIMARY KEY (verification_id);


--
-- TOC entry 4824 (class 2606 OID 16648)
-- Name: friendships friendships_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.friendships
    ADD CONSTRAINT friendships_pkey PRIMARY KEY (friendship_id);


--
-- TOC entry 4822 (class 2606 OID 16632)
-- Name: payments payments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payments
    ADD CONSTRAINT payments_pkey PRIMARY KEY (payment_id);


--
-- TOC entry 4829 (class 2606 OID 16650)
-- Name: friendships unique_friendship; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.friendships
    ADD CONSTRAINT unique_friendship UNIQUE (requester_id, addressee_id);


--
-- TOC entry 4833 (class 2606 OID 16670)
-- Name: user_sessions user_sessions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_sessions
    ADD CONSTRAINT user_sessions_pkey PRIMARY KEY (session_id);


--
-- TOC entry 4812 (class 2606 OID 16598)
-- Name: users users_email_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_email_key UNIQUE (email);


--
-- TOC entry 4814 (class 2606 OID 16596)
-- Name: users users_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_pkey PRIMARY KEY (user_id);


--
-- TOC entry 4817 (class 1259 OID 16691)
-- Name: idx_debts_creditor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_debts_creditor ON public.debts USING btree (creditor_id);


--
-- TOC entry 4818 (class 1259 OID 16692)
-- Name: idx_debts_debtor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_debts_debtor ON public.debts USING btree (debtor_id);


--
-- TOC entry 4819 (class 1259 OID 16693)
-- Name: idx_debts_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_debts_status ON public.debts USING btree (status);


--
-- TOC entry 4825 (class 1259 OID 16696)
-- Name: idx_friendships_addressee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_friendships_addressee ON public.friendships USING btree (addressee_id);


--
-- TOC entry 4826 (class 1259 OID 16695)
-- Name: idx_friendships_requester; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_friendships_requester ON public.friendships USING btree (requester_id);


--
-- TOC entry 4827 (class 1259 OID 16697)
-- Name: idx_friendships_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_friendships_status ON public.friendships USING btree (status);


--
-- TOC entry 4820 (class 1259 OID 16694)
-- Name: idx_payments_debt; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payments_debt ON public.payments USING btree (debt_id);


--
-- TOC entry 4830 (class 1259 OID 16699)
-- Name: idx_sessions_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sessions_active ON public.user_sessions USING btree (is_active);


--
-- TOC entry 4831 (class 1259 OID 16698)
-- Name: idx_sessions_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sessions_user ON public.user_sessions USING btree (user_id);


--
-- TOC entry 4809 (class 1259 OID 16690)
-- Name: idx_users_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_active ON public.users USING btree (is_active);


--
-- TOC entry 4810 (class 1259 OID 16689)
-- Name: idx_users_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_email ON public.users USING btree (email);


--
-- TOC entry 4836 (class 1259 OID 16700)
-- Name: idx_verifications_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_verifications_token ON public.email_verifications USING btree (verification_token);


--
-- TOC entry 4845 (class 2620 OID 16703)
-- Name: debts update_debts_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_debts_updated_at BEFORE UPDATE ON public.debts FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- TOC entry 4846 (class 2620 OID 16704)
-- Name: friendships update_friendships_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_friendships_updated_at BEFORE UPDATE ON public.friendships FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- TOC entry 4844 (class 2620 OID 16702)
-- Name: users update_users_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON public.users FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- TOC entry 4837 (class 2606 OID 16613)
-- Name: debts debts_creditor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.debts
    ADD CONSTRAINT debts_creditor_id_fkey FOREIGN KEY (creditor_id) REFERENCES public.users(user_id);


--
-- TOC entry 4838 (class 2606 OID 16618)
-- Name: debts debts_debtor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.debts
    ADD CONSTRAINT debts_debtor_id_fkey FOREIGN KEY (debtor_id) REFERENCES public.users(user_id);


--
-- TOC entry 4843 (class 2606 OID 16684)
-- Name: email_verifications email_verifications_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_verifications
    ADD CONSTRAINT email_verifications_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


--
-- TOC entry 4840 (class 2606 OID 16656)
-- Name: friendships friendships_addressee_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.friendships
    ADD CONSTRAINT friendships_addressee_id_fkey FOREIGN KEY (addressee_id) REFERENCES public.users(user_id);


--
-- TOC entry 4841 (class 2606 OID 16651)
-- Name: friendships friendships_requester_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.friendships
    ADD CONSTRAINT friendships_requester_id_fkey FOREIGN KEY (requester_id) REFERENCES public.users(user_id);


--
-- TOC entry 4839 (class 2606 OID 16633)
-- Name: payments payments_debt_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payments
    ADD CONSTRAINT payments_debt_id_fkey FOREIGN KEY (debt_id) REFERENCES public.debts(debt_id);


--
-- TOC entry 4842 (class 2606 OID 16671)
-- Name: user_sessions user_sessions_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_sessions
    ADD CONSTRAINT user_sessions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


-- Completed on 2025-09-08 09:50:12

--
-- PostgreSQL database dump complete
--

\unrestrict EEGNcpBTOTqWCkcEZEMGLFEOTikgfcH2bIckFC4CjC6EgGKaIQXJknHJtzWU7xd

